<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Manual Graph Drawing App</title>
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body>
        <div class="app-container">
            <div class="toolbar">
                <div class="toolbar-section">
                    <button
                        id="node-mode"
                        class="tool-btn active"
                        title="Node Mode"
                    >
                        <span class="icon">‚ö´</span>
                        <span>Node</span>
                    </button>
                    <button id="edge-mode" class="tool-btn" title="Edge Mode">
                        <span class="icon">üîó</span>
                        <span>Edge</span>
                    </button>
                    <button
                        id="select-mode"
                        class="tool-btn"
                        title="Select Mode"
                    >
                        <span class="icon">üëÜ</span>
                        <span>Select</span>
                    </button>
                </div>

                <div class="toolbar-section">
                    <button
                        id="load-btn"
                        class="tool-btn"
                        title="Load Database"
                    >
                        <span class="icon">üìÇ</span>
                        <span>Load</span>
                    </button>
                    <button id="save-as-btn" class="tool-btn" title="Save As">
                        <span class="icon">üíæ</span>
                        <span>Save As</span>
                    </button>
                    <button
                        id="clear-btn"
                        class="tool-btn danger"
                        title="Clear All"
                    >
                        <span class="icon">üóëÔ∏è</span>
                    </button>
                </div>

                <div class="toolbar-section">
                    <button
                        id="save-changes"
                        class="tool-btn"
                        title="Save Changes"
                        style="display: none"
                    >
                        <span class="icon">üíæ</span>
                        <span>Save Changes</span>
                    </button>
                    <button
                        id="discard-changes"
                        class="tool-btn"
                        title="Discard Changes"
                        style="display: none"
                    >
                        <span class="icon">‚Ü∂</span>
                        <span>Discard</span>
                    </button>
                </div>

                <div class="toolbar-section">
                    <div class="search-container" style="position: relative;">
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <input
                                type="text"
                                id="node-search"
                                placeholder="Search nodes..."
                                style="
                                    padding: 6px 12px;
                                    border: 1px solid #ddd;
                                    border-radius: 4px;
                                    font-size: 13px;
                                    width: 200px;
                                "
                            />
                            <button
                                id="clear-search-btn"
                                class="tool-btn"
                                title="Clear Search"
                                style="padding: 6px 10px; display: none;"
                            >
                                ‚úï
                            </button>
                            <button
                                id="search-dialog-btn"
                                class="tool-btn"
                                title="Open Search Dialog"
                            >
                                <span class="icon">üîç</span>
                            </button>
                        </div>
                        <div
                            id="search-results"
                            class="search-dropdown hidden"
                        ></div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="canvas-container">
                    <canvas id="graph-canvas" width="800" height="600"></canvas>
                    <div id="weight-dialog" class="dialog hidden">
                        <div class="dialog-content">
                            <h3>Set Edge Properties</h3>
                            <label>Weight:</label>
                            <input
                                type="number"
                                id="weight-input"
                                placeholder="Enter weight"
                                step="0.1"
                                min="0"
                            />
                            <label>Category:</label>
                            <input
                                type="text"
                                id="edge-category"
                                placeholder="Category (optional)"
                            />
                            <div style="margin: 15px 0; text-align: center">
                                <button
                                    id="reverse-edge-btn"
                                    class="tool-btn"
                                    style="
                                        background: #007bff;
                                        color: white;
                                        border: none;
                                        border-radius: 4px;
                                        padding: 8px 16px;
                                        font-size: 12px;
                                    "
                                >
                                    ‚Ü∫ Reverse Direction
                                </button>
                            </div>
                            <div class="dialog-buttons">
                                <button id="weight-ok">OK</button>
                                <button id="weight-cancel">Cancel</button>
                                <button id="weight-delete" class="danger">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="node-dialog" class="dialog hidden">
                        <div class="dialog-content">
                            <h3>Edit Node</h3>
                            <input
                                type="text"
                                id="node-label"
                                placeholder="Node label (English)"
                            />
                            <input
                                type="text"
                                id="node-chinese"
                                placeholder="‰∏≠ÊñáÊ†áÁ≠æ (Chinese)"
                            />
                            <div
                                style="
                                    display: flex;
                                    gap: 8px;
                                    align-items: center;
                                "
                            >
                                <input
                                    type="color"
                                    id="node-color"
                                    value="#507F80"
                                />
                                <input
                                    type="text"
                                    id="node-color-hex"
                                    placeholder="#507F80"
                                    style="width: 80px; font-family: monospace"
                                />
                            </div>
                            <label>Position:</label>
                            <div
                                style="
                                    display: flex;
                                    gap: 8px;
                                    align-items: center;
                                "
                            >
                                <label style="font-size: 12px">X:</label>
                                <input
                                    type="number"
                                    id="node-x"
                                    placeholder="X coordinate"
                                    step="1"
                                    style="width: 80px"
                                />
                                <label style="font-size: 12px">Y:</label>
                                <input
                                    type="number"
                                    id="node-y"
                                    placeholder="Y coordinate"
                                    step="1"
                                    style="width: 80px"
                                />
                            </div>
                            <input
                                type="text"
                                id="node-category"
                                placeholder="Category (optional)"
                            />
                            <label>Layers:</label>
                            <input
                                type="text"
                                id="node-layers"
                                placeholder="Enter layers (comma-separated)"
                            />
                            <label>Size:</label>
                            <input
                                type="range"
                                id="node-size"
                                min="1"
                                max="100"
                                value="20"
                                step="1"
                            />
                            <span id="size-display">20</span>
                            <div class="dialog-buttons">
                                <button id="node-ok">OK</button>
                                <button id="node-cancel">Cancel</button>
                                <button id="node-delete" class="danger">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="load-dialog" class="dialog hidden">
                        <div class="dialog-content">
                            <h3>Load Database</h3>
                            <p
                                style="
                                    font-size: 12px;
                                    color: #666;
                                    margin-bottom: 12px;
                                "
                            >
                                Select a database file to load. Current unsaved
                                changes will be lost.
                            </p>
                            <div
                                id="database-list"
                                style="
                                    max-height: 300px;
                                    overflow-y: auto;
                                    border: 1px solid #ddd;
                                    border-radius: 4px;
                                    padding: 8px;
                                "
                            >
                                <p style="text-align: center; color: #999">
                                    Loading databases...
                                </p>
                            </div>
                            <div
                                id="database-pagination"
                                style="
                                    display: none;
                                    margin-top: 8px;
                                    text-align: center;
                                    font-size: 12px;
                                "
                            >
                                <button
                                    id="pagination-prev"
                                    style="
                                        padding: 6px 16px;
                                        margin: 0 4px;
                                        border: 1px solid #ddd;
                                        border-radius: 4px;
                                        background: #f9f9f9;
                                        cursor: pointer;
                                        transition: all 0.2s;
                                    "
                                >
                                    ‚Üê Prev
                                </button>
                                <span
                                    id="pagination-info"
                                    style="
                                        margin: 0 8px;
                                        color: #666;
                                        font-weight: 500;
                                    "
                                ></span>
                                <span style="margin: 0 4px; color: #666"
                                    >Go to page:</span
                                >
                                <input
                                    type="number"
                                    id="pagination-input"
                                    min="1"
                                    value="1"
                                    style="
                                        width: 50px;
                                        padding: 4px;
                                        margin: 0 4px;
                                        border: 1px solid #ddd;
                                        border-radius: 4px;
                                        text-align: center;
                                        font-size: 12px;
                                    "
                                />
                                <span
                                    id="pagination-total"
                                    style="margin: 0 4px; color: #666"
                                ></span>
                                <button
                                    id="pagination-go"
                                    style="
                                        padding: 6px 12px;
                                        margin: 0 4px;
                                        border: 1px solid #ddd;
                                        border-radius: 4px;
                                        background: #f9f9f9;
                                        cursor: pointer;
                                        transition: all 0.2s;
                                    "
                                >
                                    Go
                                </button>
                                <button
                                    id="pagination-next"
                                    style="
                                        padding: 6px 16px;
                                        margin: 0 4px;
                                        border: 1px solid #ddd;
                                        border-radius: 4px;
                                        background: #f9f9f9;
                                        cursor: pointer;
                                        transition: all 0.2s;
                                    "
                                >
                                    Next ‚Üí
                                </button>
                            </div>
                            <div class="dialog-buttons">
                                <button id="load-ok">Load</button>
                                <button id="load-cancel">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <div id="save-as-dialog" class="dialog hidden">
                        <div class="dialog-content">
                            <h3>Save As</h3>
                            <p
                                style="
                                    font-size: 12px;
                                    color: #666;
                                    margin-bottom: 12px;
                                "
                            >
                                Save current workspace to a new database file.
                            </p>
                            <label>Database filename:</label>
                            <input
                                type="text"
                                id="save-as-filename"
                                placeholder="e.g., my-graph.db"
                                style="
                                    width: 100%;
                                    padding: 8px;
                                    margin-bottom: 8px;
                                    border: 1px solid #ddd;
                                    border-radius: 4px;
                                "
                            />
                            <p
                                style="
                                    font-size: 11px;
                                    color: #999;
                                    margin-top: 4px;
                                "
                            >
                                File will be saved in the data/ directory.
                                Include .db extension.
                            </p>
                            <div class="dialog-buttons">
                                <button id="save-as-ok">Save</button>
                                <button id="save-as-cancel">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <div id="node-search-dialog" class="dialog hidden">
                        <div class="dialog-content" style="max-width: 500px;">
                            <h3>Search Nodes</h3>
                            <div style="margin-bottom: 12px;">
                                <input
                                    type="text"
                                    id="dialog-node-search"
                                    placeholder="Type to search nodes..."
                                    style="
                                        width: 100%;
                                        padding: 8px;
                                        border: 1px solid #ddd;
                                        border-radius: 4px;
                                        font-size: 13px;
                                    "
                                />
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                                    <span id="dialog-search-count" style="font-size: 12px; color: #666;">Start typing to search...</span>
                                    <button
                                        id="dialog-clear-search-btn"
                                        class="tool-btn"
                                        style="padding: 4px 8px; font-size: 12px;"
                                    >
                                        Clear
                                    </button>
                                </div>
                            </div>
                            <div
                                id="search-results-list"
                                style="
                                    max-height: 300px;
                                    overflow-y: auto;
                                    border: 1px solid #ddd;
                                    border-radius: 4px;
                                    padding: 8px;
                                    margin-bottom: 12px;
                                    background: #f9f9f9;
                                "
                            >
                                <p style="text-align: center; color: #666; font-size: 12px; margin: 20px 0;">Start typing to search for nodes...</p>
                            </div>
                            <div
                                id="dialog-pagination"
                                style="
                                    display: none;
                                    justify-content: center;
                                    align-items: center;
                                    gap: 8px;
                                    margin-bottom: 12px;
                                    padding: 8px;
                                    background: #f5f5f5;
                                    border-radius: 4px;
                                "
                            >
                                <button
                                    id="dialog-pagination-prev"
                                    class="tool-btn"
                                    style="padding: 6px 12px; font-size: 12px;"
                                    disabled
                                >
                                    ‚Üê Prev
                                </button>
                                <span
                                    id="dialog-pagination-info"
                                    style="font-size: 12px; color: #666; font-weight: 500;"
                                ></span>
                                <span style="font-size: 12px; color: #666;">Go to page:</span>
                                <input
                                    type="number"
                                    id="dialog-pagination-input"
                                    min="1"
                                    style="
                                        width: 60px;
                                        padding: 4px 8px;
                                        border: 1px solid #ddd;
                                        border-radius: 4px;
                                        font-size: 12px;
                                        text-align: center;
                                    "
                                    placeholder="Page"
                                />
                                <button
                                    id="dialog-pagination-go"
                                    class="tool-btn"
                                    style="padding: 6px 12px; font-size: 12px;"
                                >
                                    Go
                                </button>
                                <button
                                    id="dialog-pagination-next"
                                    class="tool-btn"
                                    style="padding: 6px 12px; font-size: 12px;"
                                    disabled
                                >
                                    Next ‚Üí
                                </button>
                            </div>
                            <div
                                id="selected-node-info"
                                style="
                                    display: none;
                                    padding: 12px;
                                    background: #f0f0f0;
                                    border-radius: 4px;
                                    margin-bottom: 12px;
                                    font-size: 12px;
                                "
                            >
                                <h4 style="margin-bottom: 8px; font-size: 13px;">Selected Node:</h4>
                                <div id="selected-node-details"></div>
                            </div>
                            <div class="dialog-buttons">
                                <button id="dialog-select-node-btn" disabled>Select</button>
                                <button id="dialog-search-navigate" disabled>Navigate</button>
                                <button id="dialog-search-cancel">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sidebar" id="local-graph-sidebar">
                    <div
                        class="resize-handle"
                        id="local-graph-resize-handle"
                    ></div>
                    <div class="sidebar-section">
                        <h3>Graph Info</h3>
                        <div id="graph-info">
                            <p>Nodes: <span id="node-count">0</span></p>
                            <p>Edges: <span id="edge-count">0</span></p>
                            <p>Mode: <span id="current-mode">Node</span></p>
                            <p id="search-count" style="font-size: 12px; color: #666; margin-top: 8px;">0 nodes</p>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>Selected</h3>
                        <div id="selection-info">
                            <p>Nothing selected</p>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>Instructions</h3>
                        <div class="instructions">
                            <p>
                                <strong>Node Mode:</strong> Click to create
                                nodes
                            </p>
                            <p>
                                <strong>Edge Mode:</strong> Click two nodes to
                                connect
                            </p>
                            <p>
                                <strong>Select Mode:</strong> Click to
                                select/move nodes
                            </p>
                            <p>
                                <strong>Right-click:</strong> Edit node/edge
                                properties
                            </p>
                            <p>
                                <strong>Drag:</strong> Move nodes or pan canvas
                            </p>
                            <p><strong>Scroll:</strong> Zoom in/out</p>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h4>Display Options</h4>
                        <div class="filter-controls">
                            <div style="margin-bottom: 8px">
                                <label
                                    style="
                                        font-size: 11px;
                                        display: flex;
                                        align-items: center;
                                        cursor: pointer;
                                    "
                                >
                                    <input
                                        type="checkbox"
                                        id="show-edge-arrows"
                                        style="margin-right: 6px"
                                    />
                                    Show Edge Arrows
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h4>Layer Management</h4>
                        <div style="margin-bottom: 8px;">
                            <p id="layer-summary" style="font-size: 12px; color: #666; margin-bottom: 8px;">
                                No layers defined
                            </p>
                            <button
                                id="manage-layers-btn"
                                class="tool-btn"
                                style="width: 100%; padding: 8px; font-size: 12px;"
                                title="Manage Layers"
                            >
                                <span class="icon">üìã</span>
                                Manage Layers
                            </button>
                        </div>
                        <div style="margin-top: 8px;">
                            <div style="margin-bottom: 8px;">
                                <label style="font-size: 11px; display: block; margin-bottom: 4px;">
                                    Filter Mode:
                                </label>
                                <label style="font-size: 11px; display: flex; align-items: center; cursor: pointer; margin-bottom: 4px;">
                                    <input
                                        type="radio"
                                        name="layer-filter-mode"
                                        value="include"
                                        checked
                                        style="margin-right: 6px"
                                    />
                                    Include
                                </label>
                                <label style="font-size: 11px; display: flex; align-items: center; cursor: pointer;">
                                    <input
                                        type="radio"
                                        name="layer-filter-mode"
                                        value="exclude"
                                        style="margin-right: 6px"
                                    />
                                    Exclude
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Layer Management Dialog -->
        <div id="layer-management-dialog" class="dialog hidden">
            <div class="dialog-content" style="max-width: 600px;">
                <h3>Manage Layers</h3>
                <div style="margin-bottom: 12px;">
                    <input
                        type="text"
                        id="layer-search-input"
                        placeholder="Search layers..."
                        style="
                            width: 100%;
                            padding: 8px;
                            border: 1px solid #ddd;
                            border-radius: 4px;
                            font-size: 13px;
                        "
                    />
                </div>
                <div style="margin-bottom: 12px;">
                    <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                        <label style="font-size: 12px; display: flex; align-items: center; cursor: pointer;">
                            <input
                                type="radio"
                                name="dialog-layer-filter-mode"
                                value="include"
                                checked
                                style="margin-right: 6px"
                            />
                            Include
                        </label>
                        <label style="font-size: 12px; display: flex; align-items: center; cursor: pointer;">
                            <input
                                type="radio"
                                name="dialog-layer-filter-mode"
                                value="exclude"
                                style="margin-right: 6px"
                            />
                            Exclude
                        </label>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">
                        Total: <span id="total-layers-count">0</span> | 
                        Selected: <span id="selected-layers-count">0</span>
                    </div>
                </div>
                <div
                    id="layer-grid"
                    style="
                        max-height: 300px;
                        overflow-y: auto;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        padding: 8px;
                        margin-bottom: 12px;
                        background: #f9f9f9;
                    "
                >
                    <p style="text-align: center; color: #666; font-size: 12px; margin: 20px 0;">
                        No layers defined
                    </p>
                </div>
                <div style="display: flex; gap: 8px; margin-bottom: 8px; flex-wrap: wrap;">
                    <button id="select-all-layers-btn" class="tool-btn" style="padding: 6px 12px; font-size: 12px;">
                        Select All
                    </button>
                    <button id="select-none-layers-btn" class="tool-btn" style="padding: 6px 12px; font-size: 12px;">
                        Select None
                    </button>
                    <button id="invert-selection-btn" class="tool-btn" style="padding: 6px 12px; font-size: 12px;">
                        Invert
                    </button>
                    <button id="save-layer-view-btn" class="tool-btn" style="padding: 6px 12px; font-size: 12px;">
                        Save View
                    </button>
                </div>
                <div class="dialog-buttons">
                    <button id="apply-layers-btn">Apply</button>
                    <button id="reset-layers-btn">Reset</button>
                    <button id="cancel-layers-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Layer Rename Dialog -->
        <div id="layer-rename-dialog" class="dialog hidden">
            <div class="dialog-content" style="max-width: 400px;">
                <h3>Rename Layer</h3>
                <div style="margin-bottom: 12px;">
                    <label style="font-size: 12px; display: block; margin-bottom: 4px;">
                        Current Name:
                    </label>
                    <input
                        type="text"
                        id="rename-old-layer"
                        readonly
                        style="
                            width: 100%;
                            padding: 8px;
                            border: 1px solid #ddd;
                            border-radius: 4px;
                            font-size: 13px;
                            background: #f5f5f5;
                        "
                    />
                </div>
                <div style="margin-bottom: 12px;">
                    <label style="font-size: 12px; display: block; margin-bottom: 4px;">
                        New Name:
                    </label>
                    <input
                        type="text"
                        id="rename-new-layer"
                        placeholder="Enter new layer name"
                        style="
                            width: 100%;
                            padding: 8px;
                            border: 1px solid #ddd;
                            border-radius: 4px;
                            font-size: 13px;
                        "
                    />
                </div>
                <div id="rename-usage-info" style="font-size: 11px; color: #666; margin-bottom: 8px;">
                    This layer is used by 0 node(s)
                </div>
                <div id="rename-error" style="display: none; color: #d32f2f; font-size: 12px; margin-bottom: 8px; padding: 8px; background: #ffebee; border-radius: 4px;">
                </div>
                <div class="dialog-buttons">
                    <button id="rename-apply-btn">Rename</button>
                    <button id="rename-cancel-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Load UI functions -->
        <script src="ui-functions.js"></script>

        <!-- Main Application -->
        <script type="module" src="graph.js"></script>
        <script type="module" src="app.js"></script>
    </body>
</html>
